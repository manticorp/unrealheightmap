/*! For license information please see processor.js.LICENSE.txt */
(()=>{"use strict";var e,t,r,n,a,o={673:(e,t,r)=>{var n;r.d(t,{e9:()=>n}),function(e){e[e.Off=0]="Off",e[e.Regular=1]="Regular",e[e.Smart=2]="Smart",e[e.SmartWindow=3]="SmartWindow",e[e.Fixed=4]="Fixed"}(n||(n={}))},590:(e,t,r)=>{r.d(t,{p:()=>c});const n=Symbol("Comlink.proxy"),a=Symbol("Comlink.endpoint"),o=Symbol("Comlink.releaseProxy"),i=Symbol("Comlink.finalizer"),s=Symbol("Comlink.thrown"),u=e=>"object"==typeof e&&null!==e||"function"==typeof e,f=new Map([["proxy",{canHandle:e=>u(e)&&e[n],serialize(e){const{port1:t,port2:r}=new MessageChannel;return c(e,t),[r,[r]]},deserialize:e=>(e.start(),y(e,[],undefined))}],["throw",{canHandle:e=>u(e)&&s in e,serialize({value:e}){let t;return t=e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[t,[]]},deserialize(e){if(e.isError)throw Object.assign(new Error(e.value.message),e.value);throw e.value}}]]);function c(e,t=globalThis,r=["*"]){t.addEventListener("message",(function a(o){if(!o||!o.data)return;if(!function(e,t){for(const r of e){if(t===r||"*"===r)return!0;if(r instanceof RegExp&&r.test(t))return!0}return!1}(r,o.origin))return void console.warn(`Invalid origin '${o.origin}' for comlink proxy`);const{id:u,type:f,path:m}=Object.assign({path:[]},o.data),h=(o.data.argumentList||[]).map(x);let p;try{const t=m.slice(0,-1).reduce(((e,t)=>e[t]),e),r=m.reduce(((e,t)=>e[t]),e);switch(f){case"GET":p=r;break;case"SET":t[m.slice(-1)[0]]=x(o.data.value),p=!0;break;case"APPLY":p=r.apply(t,h);break;case"CONSTRUCT":p=function(e){return Object.assign(e,{[n]:!0})}(new r(...h));break;case"ENDPOINT":{const{port1:t,port2:r}=new MessageChannel;c(e,r),p=function(e,t){return v.set(e,t),e}(t,[t])}break;case"RELEASE":p=void 0;break;default:return}}catch(e){p={value:e,[s]:0}}Promise.resolve(p).catch((e=>({value:e,[s]:0}))).then((r=>{const[n,o]=E(r);t.postMessage(Object.assign(Object.assign({},n),{id:u}),o),"RELEASE"===f&&(t.removeEventListener("message",a),l(t),i in e&&"function"==typeof e[i]&&e[i]())})).catch((e=>{const[r,n]=E({value:new TypeError("Unserializable return value"),[s]:0});t.postMessage(Object.assign(Object.assign({},r),{id:u}),n)}))})),t.start&&t.start()}function l(e){(function(e){return"MessagePort"===e.constructor.name})(e)&&e.close()}function m(e){if(e)throw new Error("Proxy has been released and is not useable")}function h(e){return w(e,{type:"RELEASE"}).then((()=>{l(e)}))}const p=new WeakMap,d="FinalizationRegistry"in globalThis&&new FinalizationRegistry((e=>{const t=(p.get(e)||0)-1;p.set(e,t),0===t&&h(e)}));function y(e,t=[],r=function(){}){let n=!1;const i=new Proxy(r,{get(r,a){if(m(n),a===o)return()=>{!function(e){d&&d.unregister(e)}(i),h(e),n=!0};if("then"===a){if(0===t.length)return{then:()=>i};const r=w(e,{type:"GET",path:t.map((e=>e.toString()))}).then(x);return r.then.bind(r)}return y(e,[...t,a])},set(r,a,o){m(n);const[i,s]=E(o);return w(e,{type:"SET",path:[...t,a].map((e=>e.toString())),value:i},s).then(x)},apply(r,o,i){m(n);const s=t[t.length-1];if(s===a)return w(e,{type:"ENDPOINT"}).then(x);if("bind"===s)return y(e,t.slice(0,-1));const[u,f]=g(i);return w(e,{type:"APPLY",path:t.map((e=>e.toString())),argumentList:u},f).then(x)},construct(r,a){m(n);const[o,i]=g(a);return w(e,{type:"CONSTRUCT",path:t.map((e=>e.toString())),argumentList:o},i).then(x)}});return function(e,t){const r=(p.get(t)||0)+1;p.set(t,r),d&&d.register(e,t,e)}(i,e),i}function g(e){const t=e.map(E);return[t.map((e=>e[0])),(r=t.map((e=>e[1])),Array.prototype.concat.apply([],r))];var r}const v=new WeakMap;function E(e){for(const[t,r]of f)if(r.canHandle(e)){const[n,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:n},a]}return[{type:"RAW",value:e},v.get(e)||[]]}function x(e){switch(e.type){case"HANDLER":return f.get(e.name).deserialize(e.value);case"RAW":return e.value}}function w(e,t,r){return new Promise((n=>{const a=new Array(4).fill(0).map((()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16))).join("-");e.addEventListener("message",(function t(r){r.data&&r.data.id&&r.data.id===a&&(e.removeEventListener("message",t),n(r.data))})),e.start&&e.start(),e.postMessage(Object.assign({id:a},t),r)}))}}},i={};function s(e){var t=i[e];if(void 0!==t)return t.exports;var r=i[e]={exports:{}};return o[e](r,r.exports,s),r.exports}s.d=(e,t)=>{for(var r in t)s.o(t,r)&&!s.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e=s(590),t=s(673),r={width:100,depth:100,height:10},n={from:null,to:null},a={normaliseTypedArray:function(e,t){var r=2;Array.isArray(e)||(r=e instanceof Float32Array?2:e.BYTES_PER_ELEMENT);var n="number"==typeof t.to?t.to:e.reduce((function(e,t){return Math.max(e,t)}),0),a="number"==typeof t.from?t.from:e.reduce((function(e,t){return Math.min(e,t)}),n),o=Math.pow(2,8*r),i=n-a,s=o-0;return e.forEach((function(t,r){e[r]=t>=n?o:t<=a?0:(t-a)/i*s+0})),{data:e,minBefore:a,maxBefore:n,minAfter:0,maxAfter:o}},normaliseTypedArraySmart:function(e,t){var r=2;Array.isArray(e)||(r=e instanceof Float32Array?2:e.BYTES_PER_ELEMENT);var n=e.length,a=e.reduce((function(e,t){return e+t}))/n,o=Math.sqrt(e.map((function(e){return Math.pow(e-a,2)})).reduce((function(e,t){return e+t}))/n),i=e.reduce((function(e,t){return Math.max(e,t)}),0),s="number"==typeof t.to?t.to:Math.min(a+10*o,i),u=e.reduce((function(e,t){return Math.min(e,t)}),s),f="number"==typeof t.from?t.from:Math.max(a-10*o,u),c=Math.pow(2,8*r),l=s-f,m=c-0;return e.forEach((function(t,r){e[r]=t>=s?c:t<=f?0:(t-f)/l*m+0})),{data:e,minBefore:u,maxBefore:i,minAfter:0,maxAfter:c}},normaliseTypedArraySmartWindow:function(e,t){var r=2;Array.isArray(e)||(r=e instanceof Float32Array?2:e.BYTES_PER_ELEMENT);var n=e.length,a=e.reduce((function(e,t){return e+t}))/n,o=Math.sqrt(e.map((function(e){return Math.pow(e-a,2)})).reduce((function(e,t){return e+t}))/n),i=e.slice(0);i.sort();var s=Math.ceil(5e-4*i.length),u=Math.floor(.999*i.length),f=i.subarray(s,u),c=i[i.length-1],l=f[f.length-1],m=i[0],h=f[0],p="number"==typeof t.to?t.to:l+o>c?c:l,d="number"==typeof t.from?t.from:h-o<m?m:h,y=Math.pow(2,8*r)-1,g=p-d,v=y-0;return e.forEach((function(t,r){e[r]=t>=p?y:t<=d?0:(t-d)/g*v+0})),{data:e,minBefore:d,maxBefore:p,minAfter:0,maxAfter:y}},combineImages:function(e,r,a){void 0===r&&(r=t.e9.Regular),void 0===a&&(a=n);for(var o=e[0].width*e[0].height,i=new Float32Array(o),s=.00390625,u={},f=0,c=e;f<c.length;f++)u[(d=c[f]).x]||(u[d.x]={}),u[d.x][d.y]=d;for(var l={x1:e[0].exactPos.x-e[0].widthInTiles/2,x2:e[0].exactPos.x+e[0].widthInTiles/2,y1:e[0].exactPos.y-e[0].heightInTiles/2,y2:e[0].exactPos.y+e[0].heightInTiles/2},m=0,h=l.y1;h<l.y2;h+=s)for(var p=l.x1;p<l.x2;p+=s){var d={x:Math.floor(p),y:Math.floor(h)},y={x:Math.floor(p%1*256),y:Math.floor(h%1*256)},g=256*y.y+y.x;if(void 0===u[d.x])throw new Error("x value ".concat(d.x," was undefined"));if(void 0===u[d.x][d.y])throw new Error("y value ".concat(d.y," was undefined"));i[m++]=u[d.x][d.y].heights[g]}var v={data:i,minBefore:Math.pow(2,32),maxBefore:0,minAfter:Math.pow(2,32),maxAfter:0};if(r==t.e9.Regular||"number"==typeof a.from&&"number"==typeof a.to)v=this.normaliseTypedArray(i,a);else if(r==t.e9.Smart)v=this.normaliseTypedArraySmart(i,a);else if(r==t.e9.SmartWindow)v=this.normaliseTypedArraySmartWindow(i,a);else{for(var E=0;E<i.length;E++)v.maxAfter=Math.max(i[E],v.maxAfter),v.minAfter=Math.min(i[E],v.minAfter);v.maxBefore=v.maxAfter,v.minBefore=v.minAfter}return v},typedArrayToStl:function(e,t,n,a){var o=void 0===a?r:a,i=(o.width,o.depth,o.height,t*n*50);console.log(e.length,i);var s=new ArrayBuffer(i),u=new DataView(s);u.setUint32(80,(t-1)*(n-1),!0);for(var f=e.reduce((function(e,t){return Math.max(t,e)}),0),c=function(e,r){return r*t+e},l=function(e,t){e.flat().forEach((function(e,r){u.setFloat32(t+4*r,e,!0)}))},m=84,h=0;h<t-1;h+=2)for(var p=0;p<n-1;p++)l([[0,0,0],[h,p,e[c(h,p)]/f],[h+1,p,e[c(h+1,p)]/f],[h,p+1,e[c(h,p+1)]/f]],m),m+=50,l([[0,0,0],[h+1,p,e[c(h+1,p)]/f],[h+1,p+1,e[c(h+1,p+1)]/f],[h,p+1,e[c(h,p+1)]/f]],m),m+=50;return s}},e.p(a)})();